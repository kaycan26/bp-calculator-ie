@page
@model BPCalculator.Pages.BloodPressureModel
@using BPCalculator

@{
    ViewData["Title"] = "BP Category Calculator";

    // ------------------------------------------------------------
    // SMALL RESULT BOX COLOURS (BP + BMI)
    // ------------------------------------------------------------

    string resultClass = "alert alert-secondary";
    string bmiResultClass = "alert alert-secondary";

    if (ViewData.ModelState.IsValid && Model.BP != null)
    {
        switch (Model.BP.Category)
        {
            case BPCategory.Low:
                resultClass = "alert alert-primary";   // blue
                break;
            case BPCategory.Ideal:
                resultClass = "alert alert-success";   // green
                break;
            case BPCategory.PreHigh:
                resultClass = "alert alert-warning";   // yellow
                break;
            case BPCategory.High:
                resultClass = "alert alert-danger";    // red
                break;
        }
    }

    if (Model.BMI.HasValue && !string.IsNullOrEmpty(Model.BMICategory))
    {
        switch (Model.BMICategory)
        {
            case "Underweight":
                bmiResultClass = "alert alert-primary";    // blue
                break;
            case "Normal":
                bmiResultClass = "alert alert-success";    // green
                break;
            case "Overweight":
                bmiResultClass = "alert alert-warning";    // yellow
                break;
            case "Obese":
                bmiResultClass = "alert alert-danger";     // red
                break;
            default:
                bmiResultClass = "alert alert-secondary";
                break;
        }
    }

    // ------------------------------------------------------------
    // BIG PANEL BACKGROUND COLOURS (DIRECT HEX VALUES)
    // ------------------------------------------------------------

    string bpPanelBackground = "#ffffff"; // default white
    if (ViewData.ModelState.IsValid && Model.BP != null)
    {
        switch (Model.BP.Category)
        {
            case BPCategory.Low: bpPanelBackground = "#E3F2FD"; break; // blue-ish
            case BPCategory.Ideal: bpPanelBackground = "#E3F4E8"; break; // green
            case BPCategory.PreHigh: bpPanelBackground = "#FFF4CC"; break; // yellow
            case BPCategory.High: bpPanelBackground = "#FDE2E1"; break; // red/orange
        }
    }

    string bmiPanelBackground = "#ffffff"; // default white
    if (Model.BMI.HasValue && !string.IsNullOrEmpty(Model.BMICategory))
    {
        switch (Model.BMICategory)
        {
            case "Underweight": bmiPanelBackground = "#E3F2FD"; break; // blue
            case "Normal": bmiPanelBackground = "#E3F4E8"; break; // green
            case "Overweight": bmiPanelBackground = "#FFF4CC"; break; // yellow
            case "Obese": bmiPanelBackground = "#FDE2E1"; break; // red/orange
        }
    }
}

<h4>BP Category Calculator</h4>
<hr />

<div class="row g-4">

    <!-- ===========================================================
         LEFT COLUMN – INPUT FORM + SMALL RESULT BOXES
    ============================================================ -->
    <div class="col-lg-4">
        <div class="card bp-card h-100 border-0 bg-transparent">
            <!-- Thicker, more rounded green frame lives on BODY -->
            <div class="card-body border border-success border-3 rounded-5 shadow-sm bg-white">

                <form method="post" id="form1">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <!-- BP Inputs -->
                    <div class="form-group">
                        <label asp-for="BP.Systolic" class="control-label">Systolic</label>
                        <input asp-for="BP.Systolic" class="form-control" />
                        <span asp-validation-for="BP.Systolic" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="BP.Diastolic" class="control-label">Diastolic</label>
                        <input asp-for="BP.Diastolic" class="form-control" />
                        <span asp-validation-for="BP.Diastolic" class="text-danger"></span>
                    </div>

                    <!-- BMI Inputs -->
                    <h5 class="mt-4">BMI Calculator</h5>

                    <div class="form-group">
                        <label asp-for="HeightCm" class="control-label">Height (cm)</label>
                        <input asp-for="HeightCm" class="form-control" />
                        <span asp-validation-for="HeightCm" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="WeightKg" class="control-label">Weight (kg)</label>
                        <input asp-for="WeightKg" class="form-control" />
                        <span asp-validation-for="WeightKg" class="text-danger"></span>
                    </div>

                    <div class="form-group mt-3">
                        <!-- pill-shaped submit button -->
                        <input type="submit" value="Submit" class="btn btn-success rounded-pill px-4" />
                    </div>
                </form>

                <!-- Small BP Result Box -->
                <div class="mt-4">
                    <label class="fw-semibold">BP Result:</label>
                    <div id="bpResult" class="@resultClass result-box">
                        @if (ViewData.ModelState.IsValid && Model.BP != null)
                        {
                            @Model.BP.Category.ToString()
                        }
                        else
                        {
                            <span>No BP result yet.</span>
                        }
                    </div>
                </div>

                <!-- Small BMI Result Box -->
                <div class="mt-3">
                    <label class="fw-semibold">BMI Result:</label>
                    <div id="bmiResult" class="@bmiResultClass result-box">
                        @if (Model.BMI.HasValue && !string.IsNullOrEmpty(Model.BMICategory))
                        {
                            <strong>@($"{Model.BMI} ({Model.BMICategory})")</strong>
                        }
                        else
                        {
                            <span>No BMI calculated yet.</span>
                        }
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ===========================================================
         MIDDLE COLUMN – BP DESCRIPTION PANEL (DYNAMIC COLOUR)
    ============================================================ -->
    <div class="col-lg-4">
        <div class="card info-card info-card-bp h-100 border-0 bg-transparent">
            <div class="card-body border border-success border-3 rounded-5 shadow-sm"
                 style="background-color:@bpPanelBackground;">
                @if (ViewData.ModelState.IsValid && Model.BP != null)
                {
                    <h5 class="fw-bold mb-3">@Model.BP.CategoryDisplayName</h5>
                    <p>Your reading: @Model.BP.Systolic / @Model.BP.Diastolic mmHg</p>
                    <p>@Html.Raw(Model.BP.AdviceText.Replace("\n", "<br />"))</p>
                }
                else
                {
                    <h5 class="fw-bold mb-3">Blood Pressure Information</h5>
                    <p>Enter your BP values to view guidance.</p>
                }
            </div>
        </div>
    </div>

    <!-- ===========================================================
         RIGHT COLUMN – BMI DESCRIPTION PANEL (DYNAMIC COLOUR)
    ============================================================ -->
    <div class="col-lg-4">
        <div class="card info-card info-card-bmi h-100 border-0 bg-transparent">
            <div class="card-body border border-success border-3 rounded-5 shadow-sm"
                 style="background-color:@bmiPanelBackground;">
                @if (Model.BMI.HasValue && !string.IsNullOrEmpty(Model.BMICategory))
                {
                    <p class="mb-3">
                        Your BMI is <strong>@Model.BMI</strong> – <strong>@Model.BMICategory</strong>.
                    </p>
                    <p>@Html.Raw(Model.BMIAdvice.Replace("\n", "<br />"))</p>
                }
                else
                {
                    <h5 class="fw-bold mb-3">BMI Information</h5>
                    <p>Enter height and weight to view BMI guidance.</p>
                }
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
